<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.winway.scm.persistence.dao.ScmXsEveryDayContractProductDao">
    <resultMap id="ScmXsEveryDayContractProduct" type="com.winway.scm.model.ScmXsEveryDayContractProduct">
        <id property="id" column="id" jdbcType="VARCHAR"/>
        <result property="EveryDayContractId" column="EveryDayContractId" jdbcType="VARCHAR"/>
        <result property="productGauge" column="productGauge" jdbcType="VARCHAR"/>
        <result property="MedicineType" column="MedicineType" jdbcType="VARCHAR"/>
        <result property="commonName" column="commonName" jdbcType="VARCHAR"/>
        <result property="unit" column="unit" jdbcType="VARCHAR"/>
        <result property="Achange" column="Achange" jdbcType="NUMERIC"/>
        <result property="suppyType" column="suppyType" jdbcType="VARCHAR"/>
        <result property="suggestApplyNum" column="suggestApplyNum" jdbcType="NUMERIC"/>
        <result property="lastShipmentDate" column="lastShipmentDate" jdbcType="TIMESTAMP"/>
        <result property="SMSCurrentMonthSales" column="SMSCurrentMonthSales" jdbcType="NUMERIC"/>
        <result property="productCode" column="productCode" jdbcType="VARCHAR"/>
        <result property="isSMS" column="isSMS" jdbcType="VARCHAR"/>
        <result property="theNumber" column="theNumber" jdbcType="NUMERIC"/>
        <result property="packageNum" column="packageNum" jdbcType="NUMERIC"/>
        <result property="unitPrice" column="unitPrice" jdbcType="NUMERIC"/>
        <result property="sumPrice" column="sumPrice" jdbcType="NUMERIC"/>
        <result property="surplusSUm" column="surplusSUm" jdbcType="NUMERIC"/>
        <result property="productName" column="productName" jdbcType="VARCHAR"/>
    </resultMap>

    <resultMap id="scmXsDailyContractTask" type="com.winway.scm.model.ScmXsDailyContractTask">
        <id property="id" column="id" jdbcType="VARCHAR"/>
        <result property="theNumber" column="theNumber" jdbcType="NUMERIC"/>
        <result property="contractId" column="contractId" jdbcType="VARCHAR"/>
        <result property="contractCode" column="contractCode" jdbcType="VARCHAR"/>
        <result property="unitPrice" column="unitPrice" jdbcType="NUMERIC"/>
        <result property="sumPrice" column="sumPrice" jdbcType="NUMERIC"/>
        <result property="Achange" column="Achange" jdbcType="INTEGER"/>
        <result property="payType" column="payType" jdbcType="VARCHAR"/>
        <result property="ownerId" column="ownerId" jdbcType="VARCHAR"/>
        <result property="isSMS" column="isSMS" jdbcType="VARCHAR"/>
        <result property="commonName" column="commonName" jdbcType="VARCHAR"/>
        <result property="medicineType" column="MedicineType" jdbcType="VARCHAR"/>
        <result property="productGauge" column="productGauge" jdbcType="VARCHAR"/>
        <result property="specialOpinion" column="specialOpinion" jdbcType="VARCHAR"/>
        <result property="commerceState" column="commerceState" jdbcType="VARCHAR"/>
        <result property="functionType" column="functionType" jdbcType="VARCHAR"/>
        <result property="consignee" column="consignee" jdbcType="VARCHAR"/>
        <result property="phone" column="phone" jdbcType="VARCHAR"/>
        <result property="commerceName" column="commerceName" jdbcType="VARCHAR"/>
        <result property="commerceFirstId" column="commerceFirstId" jdbcType="VARCHAR"/>
        <result property="marketingWay" column="marketingWay" jdbcType="VARCHAR"/>
        <result property="productCode" column="productCode" jdbcType="VARCHAR"/>
        <result property="sendProductDate" column="sendProductDate" jdbcType="DATE"/>
        <result property="packageNum" column="packageNum" jdbcType="INTEGER"/>
    </resultMap>

    <resultMap id="allProMap" type="com.winway.scm.vo.ScmXsBigContractProductByUpdateVo">
        <id property="productId" column="productId" jdbcType="VARCHAR"/>
        <result property="productName" column="productName" jdbcType="VARCHAR"/>
        <result property="MedicineType" column="MedicineType" jdbcType="VARCHAR"/>
        <result property="commonName" column="commonName" jdbcType="VARCHAR"/>
        <result property="isSMS" column="isSMS" jdbcType="VARCHAR"/>
        <result property="lastShipmentDate" column="lastShipmentDate" jdbcType="DATE"/>

        <result property="productState" column="productState" jdbcType="VARCHAR"/>
        <result property="unit" column="unit" jdbcType="VARCHAR"/>
        <result property="agreementproductdetailId" column="agreementproductdetailId" jdbcType="VARCHAR"/>
        <result property="agreementSummaryId" column="agreementSummaryId" jdbcType="VARCHAR"/>
        <result property="productGauge" column="productGauge" jdbcType="VARCHAR"/>
        <result property="Achange" column="Achange" jdbcType="INTEGER"/>
        <result property="productCode" column="productCode" jdbcType="VARCHAR"/>
        <result property="theNumber" column="theNumber" jdbcType="INTEGER"/>
        <result property="packageNum" column="packageNum" jdbcType="INTEGER"/>
        <result property="unitPrice" column="unitPrice" jdbcType="DOUBLE"/>
        <result property="sumPrice" column="sumPrice" jdbcType="DOUBLE"/>
        <result property="suppyType" column="suppyType" jdbcType="VARCHAR"/>
    </resultMap>
    <insert id="create" parameterType="com.winway.scm.model.ScmXsEveryDayContractProduct">
		INSERT INTO SCM_XS_EveryDayContractProduct
		(id,EveryDayContractId,productGauge,MedicineType,commonName,unit,Achange,suppyType,suggestApplyNum,lastShipmentDate,
		SMSCurrentMonthSales,productCode,isSMS,theNumber,packageNum,unitPrice,sumPrice,surplusSUm,productName)
		VALUES 
		(#{id,jdbcType=VARCHAR}, #{EveryDayContractId,jdbcType=VARCHAR}, #{productGauge,jdbcType=VARCHAR}, 
		#{MedicineType,jdbcType=VARCHAR}, #{commonName,jdbcType=VARCHAR}, #{unit,jdbcType=VARCHAR}, 
		#{Achange,jdbcType=NUMERIC}, #{suppyType,jdbcType=VARCHAR}, #{suggestApplyNum,jdbcType=NUMERIC}, 
		#{lastShipmentDate,jdbcType=TIMESTAMP}, #{SMSCurrentMonthSales,jdbcType=NUMERIC}, #{productCode,jdbcType=VARCHAR}, 
		#{isSMS,jdbcType=VARCHAR}, #{theNumber,jdbcType=NUMERIC}, #{packageNum,jdbcType=NUMERIC}, #{unitPrice,jdbcType=NUMERIC}, 
		#{sumPrice,jdbcType=NUMERIC}, #{surplusSUm,jdbcType=NUMERIC},#{productName,jdbcType=VARCHAR})
	</insert>

    <select id="get" parameterType="java.lang.String" resultMap="ScmXsEveryDayContractProduct">
		SELECT * FROM SCM_XS_EveryDayContractProduct 
		WHERE 
		id=#{id}
	</select>

    <select id="query" parameterType="java.util.Map" resultMap="ScmXsEveryDayContractProduct">
        SELECT * FROM SCM_XS_EveryDayContractProduct
        <where>
            <if test="whereSql!=null">
                ${whereSql}
            </if>
        </where>
        <if test="orderBySql!=null">
            ORDER BY ${orderBySql}
        </if>
        <if test="orderBySql==null">
            ORDER BY id DESC
        </if>
    </select>


    <update id="update" parameterType="com.winway.scm.model.ScmXsEveryDayContractProduct">
		UPDATE SCM_XS_EveryDayContractProduct SET
		EveryDayContractId=#{EveryDayContractId,jdbcType=VARCHAR},
		productGauge=#{productGauge,jdbcType=VARCHAR},
		MedicineType=#{MedicineType,jdbcType=VARCHAR},
		commonName=#{commonName,jdbcType=VARCHAR},
		unit=#{unit,jdbcType=VARCHAR},
		Achange=#{Achange,jdbcType=NUMERIC},
		suppyType=#{suppyType,jdbcType=VARCHAR},
		suggestApplyNum=#{suggestApplyNum,jdbcType=NUMERIC},
		lastShipmentDate=#{lastShipmentDate,jdbcType=TIMESTAMP},
		SMSCurrentMonthSales=#{SMSCurrentMonthSales,jdbcType=NUMERIC},
		productCode=#{productCode,jdbcType=VARCHAR},
		isSMS=#{isSMS,jdbcType=VARCHAR},
		theNumber=#{theNumber,jdbcType=NUMERIC},
		packageNum=#{packageNum,jdbcType=NUMERIC},
		unitPrice=#{unitPrice,jdbcType=NUMERIC},
		sumPrice=#{sumPrice,jdbcType=NUMERIC},
		surplusSUm=#{surplusSUm,jdbcType=NUMERIC},
		productName=#{productName,jdbcType=NUMERIC}
		WHERE
		id=#{id}
	</update>

    <delete id="remove" parameterType="java.lang.String">
		DELETE FROM SCM_XS_EveryDayContractProduct 
		WHERE
		id=#{id}
	</delete>

    <delete id="delByMainId">
	    DELETE FROM SCM_XS_EveryDayContractProduct
	    WHERE
	    EveryDayContractId=#{EveryDayContractId}
	</delete>

    <select id="getByMainId" resultMap="ScmXsEveryDayContractProduct">
	    SELECT *
	    FROM SCM_XS_EveryDayContractProduct 
	    WHERE EveryDayContractId=#{EveryDayContractId}
	</select>

    <select id="getTaskInfoByContrctId" parameterType="java.lang.String" resultMap="scmXsDailyContractTask">
		SELECT
			*
		FROM
              v_dailycontracttotask
		WHERE contractId= #{id}
	</select>


    <select id="getAllProList" parameterType="java.util.Map" resultMap="allProMap">
    SELECT
    c.id AS productId,
    c.productName AS productName,
    c.MedicineType AS MedicineType,
    c.commonName AS commonName,
    c.productState AS productState,
    c.unit AS unit,
    a.id AS agreementproductdetailId,
    a.agreementSummaryId AS agreementSummaryId,
    c.productState AS productGauge,
    a.commerceCode AS productCode,
    a.supplyPrice AS unitPrice,
    b.Achange,b.productCode,b.theNumber,b.packageNum,b.sumPrice,b.isSMS,b.lastShipmentDate,
    '正常供应' AS suppyType
    FROM (SELECT * FROM scm_xs_agreementproductdetail  WHERE agreementSummaryId = #{agreementSummaryId}) a
    LEFT JOIN
    (SELECT a.id AS EveryDayContractId,a.DealerClauseId,b.Achange,b.productCode,b.theNumber,b.packageNum,b.unitPrice,b.sumPrice,b.isSMS,b.lastShipmentDate,c.AgreementSummaryId
    FROM scm_xs_everydaycontract a
    INNER JOIN scm_xs_everydaycontractproduct b ON a.id = b.EveryDayContractId AND a.id = #{id}
    INNER JOIN scm_xs_dealerclause c ON a.DealerClauseId = c.id) b
    ON a.agreementSummaryId = b.AgreementSummaryId AND a.commerceCode = b.productCode
    LEFT JOIN scm_zsj_product c ON a.commerceCode = c.productCode
    </select>
</mapper>